# 抽奖系统使用说明

## 功能特性

本系统实现了完整的抽奖功能，支持多种参与方式和开奖条件。

### 抽奖类型
1. **关键字抽奖**: 用户在群组发送指定关键字参与
2. **按钮抽奖**: 用户点击抽奖消息按钮参与

### 开奖方式
1. **定时开奖**: 到达指定时间自动开奖
2. **人数开奖**: 参与人数达到目标自动开奖

### 参与条件
1. **付费参与**: 需要花费指定金额参与
2. **仅Emby用户**: 只有拥有Emby账号的用户可参与
3. **所有人**: 群组内所有用户都可参与

## 管理员操作

### 配置管理
1. 使用 `/config` 命令进入配置面板
2. 点击"抽奖功能"开关来启用/禁用抽奖系统
3. 点击"抽奖管理"进入抽奖管理面板

### 创建抽奖
1. 在抽奖管理面板中点击"创建抽奖"
2. 按照提示格式发送抽奖信息：
   ```
   抽奖名称|描述|参与方式|开奖方式|参与条件|参数
   ```

#### 参数说明
- **参与方式**: 1=关键字参与, 2=按钮参与
- **开奖方式**: 1=定时开奖, 2=人数开奖
- **参与条件**: 1=付费参与, 2=仅Emby用户, 3=所有人

#### 示例
```
新年抽奖|祝大家新年快乐|2|1|3|2024-01-01 20:00
每日签到|签到送好礼|1|2|2|签到,100
付费抽奖|土豪专场|2|2|1|500
```

### 添加奖品
1. 创建抽奖后，添加奖品：
   ```
   抽奖ID|奖品名称|数量|描述|类型
   ```

#### 奖品类型
- `virtual`: 虚拟奖品
- `physical`: 实物奖品  
- `coins`: 积分奖品

#### 示例
```
1|iPhone 15|1|最新款苹果手机|physical
1|积分奖励|5|100积分|coins
```

### 发布抽奖
```bash
/lottery_publish <抽奖ID> <群组ID>
```

### 查看抽奖
```bash
/lottery_info <抽奖ID>
```

## 用户参与

### 关键字参与
用户在群组中发送指定关键字即可参与抽奖。

### 按钮参与
用户点击抽奖消息下方的"参与抽奖"按钮。

## 开奖机制

- **随机抽取**: 从所有参与者中随机选择获奖者
- **一人一奖**: 每位参与者在同一次抽奖中最多获得一个奖品
- **自动公布**: 开奖后自动在群组公布获奖结果

## 数据库结构

- `lottery_events`: 抽奖活动主表
- `lottery_prizes`: 奖品信息表  
- `lottery_participants`: 参与者记录表

## 定时任务

系统每5分钟检查一次是否有到期需要开奖的活动，自动执行开奖流程。